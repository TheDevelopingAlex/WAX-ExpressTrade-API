.. _sec-icasesite:

**********************
ICaseSite
**********************

.. Warning:: Only accounts created with IUser/CreateVCaseUser can access this endpoint.

Endpoints for case websites.

.. contents::




ICaseSite/GetKeyCount
======================

.. data:: GET https://api-trade.opskins.com/ICaseSite/GetKeyCount/v1

Returns the number of keys a specific user has on ExpressTrade


Authentication
---------------

API key required.


Input
-----

+-----------------------+--------+----------+---------------------------------------------+
| Parameter             | Type   | Required | Description                                 |
+=======================+========+==========+=============================================+
| trade_url or steam_id | string | +        | The trade URL or the Steam ID64 of the user |
+-----------------------+--------+----------+---------------------------------------------+

Output
-------

+-----------+--------+------------------------------------------------------+
| Parameter | Type   | Description                                          |
+===========+========+======================================================+
| key_count | string | Number of keys this user owns. Parsable into an int. |
+-----------+--------+------------------------------------------------------+




ICaseSite/GetTradeStatus
=========================

.. data:: GET https://api-trade.opskins.com/ICaseSite/GetTradeStatus/v1

Returns the Trade Status and Opened Case results from an offer created by a case website.


Authentication
---------------

API key required.


Input
------

+-----------+------+----------+-------------------------------------------------------------+
| Parameter | Type | Required | Description                                                 |
+===========+======+==========+=============================================================+
| offer_id  | int  | +        | The trade offer ID that was created by the requesting user. |
+-----------+------+----------+-------------------------------------------------------------+

Output
------

+-----------+--------+-----------------------------+
| Parameter | Type   | Description                 |
+===========+========+=============================+
| offer     | object | Standard Trade Offer Object |
+-----------+--------+-----------------------------+
| cases     | object | Standard OpenedCase Object  |
+-----------+--------+-----------------------------+




ICaseSite/SendKeyRequest
==========================

.. data:: POST https://api-trade.opskins.com/ICaseSite/SendKeyRequest/v1

Sends a trade offer to the user requesting some number of keys for uncasing items on a case website.

**Ensure that** ``remaining_opens`` **for the case id is greater than 0 via** ``ICase/GetCaseSchema`` **, or you will get an HTTP 400 error with the code 314 (TOO_MANY_REDEMPTIONS).**


Authentication
---------------

API key required.

.. Note:: OPSkins User ID can be found on the WAX ExpressTrade `settings <https://trade.opskins.com/settings/>`__ page.


Input
------

+------------------------+--------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter              | Type   | Required | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+========================+========+==========+================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
| trade_url or steam_id  | string | +        | The trade URL or the Steam ID64 of the user                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+------------------------+--------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| case_id                | int    | +        | The Case ID user wants to open                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
+------------------------+--------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| amount                 | int    |          | Number of these cases that should be opened. Defaults to 1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+------------------------+--------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| expiration_time        | int    |          | Custom expiration time for the trade offer in seconds. Minimum 120 seconds (2 minutes). Defaults to 14 days.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+------------------------+--------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| message                | string |          | Trade offer message that will be displayed to the recipient                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+------------------------+--------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| referral_uid           | int    |          | (Optional) You can choose to send this if someone has referred someone else to your site. This should be an OPSkins UID (of the referrer). If this is set, when commission for the cases in this offer is distributed, commission will be split between your site, the referrer, and the case-opening user (rebate, if set below). You may set a custom split rate under ICaseSite/UpdateCommissionSettings with referral_commission_rate. If this is the same as network_user_id in ICaseSite/UpdateCommissionSettings, the referral commission will be merged into the site's commission.                                                                    |
+------------------------+--------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| rebate_commission_rate | float  |          | (Optional) You can choose to share commission with the case-opening User. Default ``0.00%``, Max ``10.00%``, & Min ``0.01%``. If this is set, when commission for the cases in this offer is distributed, commission will be split between your site, the User, and referrer (only if set). This works similarly to ``referral_commission_rate`` in ICaseSite/UpdateCommissionSettings. If the case opening UID is the same as ``referral_uid`` above, referral commission will be merged into the rebate commission, or if it is the same as ``network_user_id`` in ICaseSite/UpdateCommissionSettings, the rebate will be merged into the site's commission. |
+------------------------+--------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
Output
------

+-----------+--------+---------------------------------------------------------------------------------------------------------------+
| Parameter | Type   | Description                                                                                                   |
+===========+========+===============================================================================================================+
| offer     | object | Standard Trade Offer Object                                                                                   |
+-----------+--------+---------------------------------------------------------------------------------------------------------------+
| offer_url | string | Full URL to the trade offer. The recipient of this offer can click this link to view the offer and accept it. |
+-----------+--------+---------------------------------------------------------------------------------------------------------------+




ICaseSite/UpdateCommissionSettings
===================================

.. data:: POST https://api-trade.opskins.com/ICaseSite/UpdateCommissionSettings/v1

Update commission settings for your VCaseUser. Link your OPSkins account to receive commission directly into your USD Wallet.


Authentication
---------------

API key required.


Input
------

+--------------------------+-------+----------+------------------------------------------------------------+
| Parameter                | Type  | Required | Description                                                |
+==========================+=======+==========+============================================================+
| network_id               | int   | +        | The ID of the network. 1 for OPSkins.com                   |
+--------------------------+-------+----------+------------------------------------------------------------+
| network_user_id          | int   | +        | User ID on the network. For OPSkins, your OPSkins User ID. |
+--------------------------+-------+----------+------------------------------------------------------------+
| referral_commission_rate | float |          | (Below)                                                    |
+--------------------------+-------+----------+------------------------------------------------------------+

.. Important::
  | This is OPTIONAL!
  |
  | Want all the commission? Don't worry about this.
  | This only matters if you send ``referral_uid`` with ``ICaseSite/SendKeyRequest``.
  |
  | Want to share commission with referrering users?
  | This property is how many percent commission referrers should receive from total commission percentage (currently 10.00%). Default 5.00%, Max 10.00%, & Min 0.01%.
  | The 'referrer' is ``referral_uid`` (OPSkins UID), which can be sent when sending ``ICaseSite/SendKeyRequest``. You have to get this from the user (they have to provide to you) and then you can send it.
  |
  | For example, if this is set to 5.00 %, you will get $0.13 and the referrer $0.12, as the total commission amount (for each case) is 10% of a Skeleton Key, which is $0.25. So by default (5.00%), the referrer will get half the commission $0.12.

.. Note:: You can find your OPSkins User ID on the WAX ExpressTrade `settings <https://trade.opskins.com/settings/>`__ page.

Output
------

+--------------------------+-------+---------------------------------------------------+
| Parameter                | Type  | Description                                       |
+==========================+=======+===================================================+
| network_id               | int   | Returns database value (should be same as input). |
+--------------------------+-------+---------------------------------------------------+
| network_user_id          | int   | Returns database value (should be same as input). |
+--------------------------+-------+---------------------------------------------------+
| referral_commission_rate | float | Returns database value (should be same as input). |
+--------------------------+-------+---------------------------------------------------+


.. code-block:: json
    :caption: Output Example 

    {
        "status": 1,
        "time": 1531449864,
        "response": {
            "network_id": 1,
            "network_user_id": 1234567891,
            "referral_commission_rate": 2.5
        }
    }
